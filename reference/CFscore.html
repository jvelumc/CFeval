<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Counterfactual validation score — CFscore • CFeval</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Counterfactual validation score — CFscore"><meta name="description" content="Counterfactual validation score"><meta property="og:description" content="Counterfactual validation score"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CFeval</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/CFeval.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Counterfactual validation score</h1>

      <div class="d-none name"><code>CFscore.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Counterfactual validation score</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">CFscore</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">outcome_formula</span>,</span>
<span>  <span class="va">treatment_formula</span>,</span>
<span>  <span class="va">treatment_of_interest</span>,</span>
<span>  metrics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"auc"</span>, <span class="st">"brier"</span>, <span class="st">"oeratio"</span>, <span class="st">"oeratio_pp"</span>, <span class="st">"calplot"</span><span class="op">)</span>,</span>
<span>  <span class="va">time_horizon</span>,</span>
<span>  cens.model <span class="op">=</span> <span class="st">"cox"</span>,</span>
<span>  null.model <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  stable_iptw <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  bootstrap <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  bootstrap_progress <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">iptw</span>,</span>
<span>  <span class="va">ipcw</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>One of the following three options to be validated:</p><ul><li><p>a numeric vector, corresponding to risk predictions</p></li>
<li><p>a glm or coxph model</p></li>
<li><p>a (named) list, with one or more of the previous 2 options, for
  validating and comparing multiple models at once.</p></li>
</ul></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A data.frame containing at least the observed outcome, assigned
treatment, and necessary confounders for the validation of object.</p></dd>


<dt id="arg-outcome-formula">outcome_formula<a class="anchor" aria-label="anchor" href="#arg-outcome-formula"></a></dt>
<dd><p>A formula which identifies the outcome (left hand
side). E.g. Y ~ 1 for binary and Surv(time, status) ~ 1 for time-to-event
outcomes. In right censored data, the right hand side of the formula is
used to estimate the inverse probability of censoring weights (IPCW) model.
Alternatively, the IPCW can also be specified themselves using the ipcw
argument, in which case the right hand side of this formula is ignored.</p></dd>


<dt id="arg-treatment-formula">treatment_formula<a class="anchor" aria-label="anchor" href="#arg-treatment-formula"></a></dt>
<dd><p>A formula which identifies the treatment (left hand
side). E.g. A ~ 1. The right hand side of the formula can be used to
specify the confounders used to estimate the inverse probability of
treatment weights (IPTW) model. E.g. A ~ L, where L is the confounder
required to adjust for treatment. The IPTW can also be specified themselves
using the iptw argument, in which case the right hand side of this formula
is ignored.</p></dd>


<dt id="arg-treatment-of-interest">treatment_of_interest<a class="anchor" aria-label="anchor" href="#arg-treatment-of-interest"></a></dt>
<dd><p>A treatment level for which the counterfactual
perormance measures should be evaluated.</p></dd>


<dt id="arg-metrics">metrics<a class="anchor" aria-label="anchor" href="#arg-metrics"></a></dt>
<dd><p>A character vector specifying which performance metrics to be
computed. Options are c("auc", "brier", "oeratio", "oeratio_pp",
"calplot"). See details.</p></dd>


<dt id="arg-time-horizon">time_horizon<a class="anchor" aria-label="anchor" href="#arg-time-horizon"></a></dt>
<dd><p>For time to event data, the prediction horizon of
interest.</p></dd>


<dt id="arg-cens-model">cens.model<a class="anchor" aria-label="anchor" href="#arg-cens-model"></a></dt>
<dd><p>Model for estimating inverse probability of censoring
weights (IPCW). Methods currently implemented are Kaplan-Meier ("KM") or
Cox ("cox") both applied to the censored times.</p></dd>


<dt id="arg-null-model">null.model<a class="anchor" aria-label="anchor" href="#arg-null-model"></a></dt>
<dd><p>If TRUE fit a risk prediction model which ignores the
covariates and predicts the same value for all subjects. The model is
fitted using the data in which all subjects are counterfactually assigned
the treatment of interest (using the IPTW, as estimated using the
treatment_formula or as given by the iptw argument). For time-to-event
outcomes, the subjects are also counterfactually uncensored (using the
IPCW, as estimated using the outcome_formula, or as given by the ipcw
argument).</p></dd>


<dt id="arg-stable-iptw">stable_iptw<a class="anchor" aria-label="anchor" href="#arg-stable-iptw"></a></dt>
<dd><p>if TRUE, estimate stabilized IPTW weights. See details.</p></dd>


<dt id="arg-bootstrap">bootstrap<a class="anchor" aria-label="anchor" href="#arg-bootstrap"></a></dt>
<dd><p>If this is an integer greater than 0, this indicates the
number of bootstrap iterations, to compute 95% confidence intervals around
the performance metrics.</p></dd>


<dt id="arg-iptw">iptw<a class="anchor" aria-label="anchor" href="#arg-iptw"></a></dt>
<dd><p>A numeric vector, containing the inverse probability of treatment
weights. These are normally computed using the treatment_formula, but they
can be specified directly via this argument. If specified via this
argument, bootstrap is not possible.</p></dd>


<dt id="arg-ipcw">ipcw<a class="anchor" aria-label="anchor" href="#arg-ipcw"></a></dt>
<dd><p>A numeric vector, containing the inverse probability of censor
weights. These are normally computed using the outcome_formula, but they
can be specified directly via this argument. If specified via this
argument, bootstrap is not possible.</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>If set to TRUE, don't print assumptions.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with performance metrics.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>auc is area under the (ROC) curve, estimated ...</p>
<p>Brier score is defined as 1 / sum(iptw) sum(predictions_i - outcome_i)^2</p>
<p>oeratio and oeratio_pp represent the observed/expected ratio, where
  observed is the mean of the outcomes in the pseudopopulation. For oeratio,
  the expected is the mean of the predictions in the original observed
  population. For oeratio_pp, expected is the mean of the predictions in the
  pseudopopulation. A perfect model will have oeratio_pp equal to exactly
  one, but not necessarily oeratio equal to one, if the size of the
  (weighted) pseudopopulation is not exactly equal to the size of the
  original population.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>L <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span>, P <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data</span><span class="op">$</span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">L</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'L' not found</span>
<span class="r-in"><span><span class="va">data</span><span class="op">$</span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="fl">0.1</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">*</span><span class="va">data</span><span class="op">$</span><span class="va">L</span> <span class="op">+</span> <span class="fl">0.7</span><span class="op">*</span><span class="va">data</span><span class="op">$</span><span class="va">P</span> <span class="op">-</span> <span class="fl">0.8</span><span class="op">*</span><span class="va">data</span><span class="op">$</span><span class="va">A</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>NAs produced</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">random</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">A</span> <span class="op">+</span> <span class="va">P</span>, data <span class="op">=</span> <span class="va">data</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in eval(predvars, data, env):</span> object 'A' not found</span>
<span class="r-in"><span><span class="va">perfect</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">Y</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">CFscore</span><span class="op">(</span></span></span>
<span class="r-in"><span>  object <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"ran"</span> <span class="op">=</span> <span class="va">random</span>, <span class="st">"mod"</span> <span class="op">=</span> <span class="va">model</span>, <span class="st">"per"</span> <span class="op">=</span> <span class="va">perfect</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">data</span>,</span></span>
<span class="r-in"><span>  outcome_formula <span class="op">=</span> <span class="va">Y</span> <span class="op">~</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>  treatment_formula <span class="op">=</span> <span class="va">A</span> <span class="op">~</span> <span class="va">L</span>,</span></span>
<span class="r-in"><span>  treatment_of_interest <span class="op">=</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in eval(predvars, data, env):</span> object 'A' not found</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jasper van Egeraat.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

