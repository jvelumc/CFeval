<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>CFeval • CFeval</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="CFeval">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CFeval</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/CFeval.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>CFeval</h1>
            
      

      <div class="d-none name"><code>CFeval.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jvelumc.github.io/CFeval/">CFeval</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="evaluating-performance-for-time-to-event-data-">Evaluating performance for time to event data.<a class="anchor" aria-label="anchor" href="#evaluating-performance-for-time-to-event-data-"></a>
</h2>
<p>The README covers binary outcome. This vignette demonstrates how to
estimate counterfactual performance metrics in right censored survival
data.</p>
<p>Just like in the binary outcome, a IPT-weighted pseudopopulation is
built which represents a situation in which everybody gets the treatment
of interest. On top of that, inverse probability of censor weights are
used such that the pseudopopulation also represents a situation where
nobody gets censored.</p>
<div class="section level3">
<h3 id="example-1-non-informative-censoring">Example 1, non informative censoring<a class="anchor" aria-label="anchor" href="#example-1-non-informative-censoring"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simulate_time_to_event</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">constant_baseline_haz</span>, <span class="va">LP</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>  <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">u</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">constant_baseline_haz</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">LP</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">horizon</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  L1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>  L2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  P1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>  P2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="fl">0.2</span> <span class="op">+</span> <span class="fl">1.2</span><span class="op">*</span><span class="va">data</span><span class="op">$</span><span class="va">L1</span> <span class="op">-</span> <span class="fl">0.3</span><span class="op">*</span><span class="va">data</span><span class="op">$</span><span class="va">L2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">LP</span> <span class="op">&lt;-</span> <span class="fl">0.8</span><span class="op">*</span><span class="va">data</span><span class="op">$</span><span class="va">L1</span> <span class="op">+</span> <span class="fl">0.3</span><span class="op">*</span><span class="va">data</span><span class="op">$</span><span class="va">L2</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">*</span><span class="va">data</span><span class="op">$</span><span class="va">P1</span> <span class="op">+</span> <span class="fl">0.7</span><span class="op">*</span><span class="va">data</span><span class="op">$</span><span class="va">P2</span></span>
<span></span>
<span><span class="co"># time0 is the uncensored untreated survival time,</span></span>
<span><span class="co"># time1 is the uncensored treated   survival time </span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">time0</span> <span class="op">&lt;-</span> <span class="fu">simulate_time_to_event</span><span class="op">(</span><span class="va">n</span>, <span class="fl">0.04</span>, <span class="va">LP</span><span class="op">)</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">time1</span> <span class="op">&lt;-</span> <span class="fu">simulate_time_to_event</span><span class="op">(</span><span class="va">n</span>, <span class="fl">0.04</span>, <span class="va">LP</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">time0</span><span class="op">)</span></span>
<span><span class="co">#&gt;      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. </span></span>
<span><span class="co">#&gt; 4.600e-04 3.218e+00 9.784e+00 2.626e+01 2.662e+01 2.217e+03</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">time1</span><span class="op">)</span></span>
<span><span class="co">#&gt;      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. </span></span>
<span><span class="co">#&gt; 5.100e-04 5.276e+00 1.621e+01 4.133e+01 4.265e+01 2.331e+03</span></span>
<span></span>
<span><span class="co"># time_a is the uncensored survival time corresponding to assigned treatment </span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">time_a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">A</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">data</span><span class="op">$</span><span class="va">time1</span>, <span class="va">data</span><span class="op">$</span><span class="va">time0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># uninformative censoring</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">censortime</span> <span class="op">&lt;-</span> <span class="fu">simulate_time_to_event</span><span class="op">(</span><span class="va">n</span>, <span class="fl">0.02</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">censortime</span><span class="op">)</span></span>
<span><span class="co">#&gt;      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. </span></span>
<span><span class="co">#&gt; 2.943e-03 5.204e+00 1.269e+01 1.806e+01 2.540e+01 1.873e+02</span></span>
<span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">status</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">time_a</span> <span class="op">&lt;=</span> <span class="va">data</span><span class="op">$</span><span class="va">censortime</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">status</span> <span class="op">==</span> <span class="cn">TRUE</span>,</span>
<span>                      <span class="va">data</span><span class="op">$</span><span class="va">time_a</span>,</span>
<span>                      <span class="va">data</span><span class="op">$</span><span class="va">censortime</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">time</span><span class="op">)</span></span>
<span><span class="co">#&gt;      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. </span></span>
<span><span class="co">#&gt;  0.000511  2.240901  5.840479  9.428037 12.855861 94.856498</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">status</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Mode   FALSE    TRUE </span></span>
<span><span class="co">#&gt; logical    5295    4705</span></span></code></pre></div>
<p>Fit some models to validate:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_naive</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">P1</span> <span class="op">+</span> <span class="va">P2</span> <span class="op">+</span> <span class="va">A</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coefficients</a></span><span class="op">(</span><span class="va">model_naive</span><span class="op">)</span></span>
<span><span class="co">#&gt;        P1        P2         A </span></span>
<span><span class="co">#&gt; 0.4135999 0.6225457 0.1652718</span></span>
<span></span>
<span><span class="va">trt_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">A</span> <span class="op">~</span> <span class="va">L1</span> <span class="op">+</span> <span class="va">L2</span>, family <span class="op">=</span> <span class="st">"binomial"</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span><span class="va">propensity_score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">trt_model</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">iptw</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">A</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">propensity_score</span>, <span class="fl">1</span> <span class="op">-</span> <span class="va">propensity_score</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_causal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">P1</span> <span class="op">+</span> <span class="va">P2</span> <span class="op">+</span> <span class="va">A</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  weights <span class="op">=</span> <span class="va">iptw</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coefficients</a></span><span class="op">(</span><span class="va">model_causal</span><span class="op">)</span></span>
<span><span class="co">#&gt;         P1         P2          A </span></span>
<span><span class="co">#&gt;  0.4004810  0.5789509 -0.4131811</span></span></code></pre></div>
<p>For this example, we validate these models on the same data that was
used to develop them. We are interested in the counterfactual
performance if every patient were to be assigned to treatment and
remained uncensored, with a prediction horizon of 5 years.</p>
<p>To account for the time to event data, the left hand side of the
outcome_formula argument should be a survival object, and the right hand
side the formula used to fit the IPCW model. In this case, we used
non-informative censoring, so we leave the right hand side just
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math>,
and we specify to use the kaplan-meier to compute the ipc-weights.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CFscore.html">CFscore</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"naive model"</span> <span class="op">=</span> <span class="va">model_naive</span>, <span class="st">"causal model"</span> <span class="op">=</span> <span class="va">model_causal</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  outcome_formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>  treatment_formula <span class="op">=</span> <span class="va">A</span> <span class="op">~</span> <span class="va">L1</span> <span class="op">+</span> <span class="va">L2</span>,</span>
<span>  treatment_of_interest <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  time_horizon <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  cens.model <span class="op">=</span> <span class="st">"KM"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">cfs</span></span>
<span><span class="co">#&gt; Estimation of the performance of the prediction model in a</span></span>
<span><span class="co">#&gt;  counterfactual (CF) dataset where everyone's treatment A was set to 1.</span></span>
<span><span class="co">#&gt; The following assumptions must be satisfied for correct inference:</span></span>
<span><span class="co">#&gt; - Conditional exchangeability requires that given IP-weights are</span></span>
<span><span class="co">#&gt;  sufficient to adjust for confounding and selection bias between</span></span>
<span><span class="co">#&gt;  treatment and outcome.</span></span>
<span><span class="co">#&gt; - Positivity (assess $ipt$weights for outliers)</span></span>
<span><span class="co">#&gt; - Consistency</span></span>
<span><span class="co">#&gt; - No interference</span></span>
<span><span class="co">#&gt; - Correctly specified propensity formula. Estimated treatment model is</span></span>
<span><span class="co">#&gt;  logit(A) = 0.24 + 1.2*L1 - 0.34*L2. See also $ipt$model</span></span>
<span><span class="co">#&gt; - Censoring is accounted for with ...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         model   auc brier oeratio</span></span>
<span><span class="co">#&gt;    null model 0.500 0.179   1.000</span></span>
<span><span class="co">#&gt;   naive model 0.674 0.170   0.791</span></span>
<span><span class="co">#&gt;  causal model 0.673 0.166   0.990</span></span></code></pre></div>
<p><img src="CFeval_files/figure-html/unnamed-chunk-4-1.png" class="r-plt" alt="" width="576"></p>
</div>
<div class="section level3">
<h3 id="example-2-informative-censoring">Example 2, informative censoring<a class="anchor" aria-label="anchor" href="#example-2-informative-censoring"></a>
</h3>
<p>We can also account for informative censoring.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span><span class="op">$</span><span class="va">censortime</span> <span class="op">&lt;-</span> <span class="fu">simulate_time_to_event</span><span class="op">(</span><span class="va">n</span>, <span class="fl">0.04</span>, <span class="fl">0.1</span><span class="op">*</span><span class="va">data</span><span class="op">$</span><span class="va">L1</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">*</span><span class="va">data</span><span class="op">$</span><span class="va">P2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">censortime</span><span class="op">)</span></span>
<span><span class="co">#&gt;      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. </span></span>
<span><span class="co">#&gt; 2.143e-03 5.525e+00 1.330e+01 2.010e+01 2.746e+01 1.877e+02</span></span>
<span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">status</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">time_a</span> <span class="op">&lt;=</span> <span class="va">data</span><span class="op">$</span><span class="va">censortime</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">status</span> <span class="op">==</span> <span class="cn">TRUE</span>,</span>
<span>                      <span class="va">data</span><span class="op">$</span><span class="va">time_a</span>,</span>
<span>                      <span class="va">data</span><span class="op">$</span><span class="va">censortime</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">time</span><span class="op">)</span></span>
<span><span class="co">#&gt;      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. </span></span>
<span><span class="co">#&gt; 5.110e-04 2.275e+00 6.187e+00 1.046e+01 1.371e+01 1.307e+02</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">status</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Mode   FALSE    TRUE </span></span>
<span><span class="co">#&gt; logical    5080    4920</span></span></code></pre></div>
<p>We then set censoring method to “cox”, and supply the formula needed
for the censoring model as the right hand side of the outcome
formula:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/CFscore.html">CFscore</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"naive model"</span> <span class="op">=</span> <span class="va">model_naive</span>, <span class="st">"causal model"</span> <span class="op">=</span> <span class="va">model_causal</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  outcome_formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">L1</span> <span class="op">+</span> <span class="va">P2</span>,</span>
<span>  treatment_formula <span class="op">=</span> <span class="va">A</span> <span class="op">~</span> <span class="va">L1</span> <span class="op">+</span> <span class="va">L2</span>,</span>
<span>  treatment_of_interest <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  time_horizon <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  cens.model <span class="op">=</span> <span class="st">"cox"</span>,</span>
<span>  bootstrap <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  bootstrap_progress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimation of the performance of the prediction model in a</span></span>
<span><span class="co">#&gt;  counterfactual (CF) dataset where everyone's treatment A was set to 1.</span></span>
<span><span class="co">#&gt; The following assumptions must be satisfied for correct inference:</span></span>
<span><span class="co">#&gt; - Conditional exchangeability requires that given IP-weights are</span></span>
<span><span class="co">#&gt;  sufficient to adjust for confounding and selection bias between</span></span>
<span><span class="co">#&gt;  treatment and outcome.</span></span>
<span><span class="co">#&gt; - Positivity (assess $ipt$weights for outliers)</span></span>
<span><span class="co">#&gt; - Consistency</span></span>
<span><span class="co">#&gt; - No interference</span></span>
<span><span class="co">#&gt; - Correctly specified propensity formula. Estimated treatment model is</span></span>
<span><span class="co">#&gt;  logit(A) = 0.24 + 1.2*L1 - 0.34*L2. See also $ipt$model</span></span>
<span><span class="co">#&gt; - Censoring is accounted for with ...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; auc</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         model   auc lower upper</span></span>
<span><span class="co">#&gt;    null model 0.500 0.500 0.500</span></span>
<span><span class="co">#&gt;   naive model 0.663 0.643 0.681</span></span>
<span><span class="co">#&gt;  causal model 0.663 0.643 0.681</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; brier</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         model brier lower upper</span></span>
<span><span class="co">#&gt;    null model 0.181 0.174 0.190</span></span>
<span><span class="co">#&gt;   naive model 0.173 0.167 0.179</span></span>
<span><span class="co">#&gt;  causal model 0.169 0.162 0.176</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; oeratio</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         model oeratio lower upper</span></span>
<span><span class="co">#&gt;    null model   1.000 0.945 1.072</span></span>
<span><span class="co">#&gt;   naive model   0.803 0.759 0.857</span></span>
<span><span class="co">#&gt;  causal model   1.005 0.950 1.073</span></span></code></pre></div>
<p><img src="CFeval_files/figure-html/unnamed-chunk-6-1.png" class="r-plt" alt="" width="576"><img src="CFeval_files/figure-html/unnamed-chunk-6-2.png" class="r-plt" alt="" width="576"><img src="CFeval_files/figure-html/unnamed-chunk-6-3.png" class="r-plt" alt="" width="576"><img src="CFeval_files/figure-html/unnamed-chunk-6-4.png" class="r-plt" alt="" width="576"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jasper van Egeraat, Nan van Geloven, Ruth Keogh.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
